<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Path D: Training Infrastructure | SIREN Tech Guide</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --siren-red: #e63946;
            --siren-orange: #f77f00;
            --siren-gradient: linear-gradient(135deg, #e63946 0%, #f77f00 100%);
            --dark-bg: #0a0a0b;
            --card-bg: rgba(255, 255, 255, 0.03);
            --card-border: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --text-muted: rgba(255, 255, 255, 0.4);
        }
        body { font-family: 'Inter', sans-serif; background: var(--dark-bg); color: var(--text-primary); min-height: 100vh; line-height: 1.7; }
        .ambient-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .ambient-orb { position: absolute; border-radius: 50%; filter: blur(100px); opacity: 0.2; }
        .orb-1 { width: 500px; height: 500px; background: var(--siren-red); top: -150px; right: -150px; }
        .orb-2 { width: 300px; height: 300px; background: var(--siren-orange); bottom: 20%; left: -100px; }
        .container { position: relative; z-index: 1; max-width: 900px; margin: 0 auto; padding: 40px 24px 80px; }
        .top-nav { display: flex; align-items: center; justify-content: space-between; margin-bottom: 60px; padding-bottom: 20px; border-bottom: 1px solid var(--card-border); }
        .back-link { display: flex; align-items: center; gap: 8px; color: var(--text-secondary); text-decoration: none; font-size: 14px; transition: color 0.3s ease; }
        .back-link:hover { color: var(--text-primary); }
        .back-link svg { width: 20px; height: 20px; }
        .nav-logo { font-size: 12px; font-weight: 600; letter-spacing: 2px; text-transform: uppercase; background: var(--siren-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .page-header { margin-bottom: 48px; }
        .path-badge { display: inline-flex; align-items: center; gap: 12px; margin-bottom: 20px; }
        .path-letter { width: 48px; height: 48px; background: var(--siren-gradient); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; }
        .path-label { font-size: 13px; font-weight: 600; letter-spacing: 2px; text-transform: uppercase; color: var(--siren-orange); }
        .page-title { font-size: clamp(32px, 5vw, 48px); font-weight: 700; margin-bottom: 16px; }
        .page-subtitle { font-size: 18px; color: var(--text-secondary); }
        .section { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 20px; padding: 36px; margin-bottom: 32px; backdrop-filter: blur(20px); }
        .section-num { font-size: 12px; font-weight: 600; letter-spacing: 2px; text-transform: uppercase; color: var(--siren-orange); margin-bottom: 12px; }
        .section h2 { font-size: 24px; font-weight: 600; margin-bottom: 20px; }
        .section h3 { font-size: 18px; font-weight: 600; margin: 28px 0 16px; }
        .section p { color: var(--text-secondary); margin-bottom: 16px; }
        .section strong { color: var(--text-primary); }
        .section ul { color: var(--text-secondary); margin: 16px 0; padding-left: 24px; }
        .section li { margin-bottom: 8px; }
        .code-block { background: rgba(0, 0, 0, 0.4); border: 1px solid var(--card-border); border-radius: 12px; padding: 20px; margin: 20px 0; overflow-x: auto; }
        .code-block code { font-family: 'JetBrains Mono', monospace; font-size: 13px; color: #e0e0e0; line-height: 1.6; white-space: pre; }
        .comment { color: #6a9955; }
        .keyword { color: #569cd6; }
        .string { color: #ce9178; }
        .number { color: #b5cea8; }
        .function { color: #dcdcaa; }
        .info-box { background: rgba(247, 127, 0, 0.1); border-left: 3px solid var(--siren-orange); padding: 16px 20px; margin: 20px 0; border-radius: 0 8px 8px 0; }
        .info-box p { margin: 0; font-size: 14px; }
        .warning-box { background: rgba(230, 57, 70, 0.1); border-left: 3px solid var(--siren-red); padding: 16px 20px; margin: 20px 0; border-radius: 0 8px 8px 0; }
        .warning-box p { margin: 0; font-size: 14px; }
        .property-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin: 20px 0; }
        .property-card { background: rgba(255, 255, 255, 0.02); border: 1px solid var(--card-border); border-radius: 12px; padding: 20px; }
        .property-name { font-family: 'JetBrains Mono', monospace; font-size: 14px; color: var(--siren-orange); margin-bottom: 8px; }
        .property-desc { font-size: 13px; color: var(--text-secondary); }
        .diagram { background: rgba(0, 0, 0, 0.3); border-radius: 12px; padding: 32px; margin: 24px 0; text-align: center; font-family: 'JetBrains Mono', monospace; }
        .diagram-row { display: flex; align-items: center; justify-content: center; gap: 16px; margin: 12px 0; flex-wrap: wrap; }
        .diagram-box { background: rgba(230, 57, 70, 0.2); border: 1px solid rgba(230, 57, 70, 0.4); border-radius: 8px; padding: 12px 20px; font-size: 13px; }
        .diagram-arrow { color: var(--siren-orange); font-size: 20px; }
        .table-wrapper { overflow-x: auto; margin: 20px 0; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th, td { padding: 12px 16px; text-align: left; border-bottom: 1px solid var(--card-border); }
        th { color: var(--text-muted); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }
        td { color: var(--text-secondary); }
        td strong { color: var(--text-primary); }
        .nav-footer { display: flex; justify-content: space-between; gap: 20px; margin-top: 48px; padding-top: 32px; border-top: 1px solid var(--card-border); flex-wrap: wrap; }
        .nav-btn { display: flex; align-items: center; gap: 12px; padding: 16px 24px; background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 12px; text-decoration: none; color: var(--text-primary); transition: all 0.3s ease; flex: 1; min-width: 200px; }
        .nav-btn:hover { border-color: rgba(230, 57, 70, 0.4); transform: translateY(-2px); }
        .nav-btn.next { justify-content: flex-end; text-align: right; }
        .nav-btn-label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
        .nav-btn-title { font-weight: 600; }
        .nav-btn svg { width: 20px; height: 20px; stroke: var(--text-secondary); }
        @media (max-width: 600px) { .section { padding: 24px; } .nav-footer { flex-direction: column; } .nav-btn.next { justify-content: flex-start; text-align: left; } }
    </style>
</head>
<body>
    <div class="ambient-bg"><div class="ambient-orb orb-1"></div><div class="ambient-orb orb-2"></div></div>
    <div class="container">
        <nav class="top-nav">
            <a href="../" class="back-link"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>Back to Overview</a>
            <span class="nav-logo">SIREN Tech Guide</span>
        </nav>

        <header class="page-header">
            <div class="path-badge"><div class="path-letter">D</div><span class="path-label">Deep Dive</span></div>
            <h1 class="page-title">Training Infrastructure</h1>
            <p class="page-subtitle">Building a system that processes content at scale</p>
        </header>

        <section class="section">
            <div class="section-num">01</div>
            <h2>The Scale Challenge</h2>
            <p>Training a single 3DGS scene takes <strong>15-45 minutes</strong> on a high-end GPU. For 4D video:</p>
            <div class="table-wrapper">
                <table>
                    <tr><th>Content</th><th>Frames</th><th>Time (1 GPU)</th><th>Time (8 GPUs)</th></tr>
                    <tr><td><strong>1 min @ 30fps</strong></td><td>1,800</td><td>~19 days</td><td>~2.3 days</td></tr>
                    <tr><td><strong>5 min scene</strong></td><td>9,000</td><td>~94 days</td><td>~12 days</td></tr>
                    <tr><td><strong>Library (100 scenes)</strong></td><td>180,000</td><td>~5 years</td><td>~7.5 months</td></tr>
                </table>
            </div>
            <p>We need <strong>massive parallelization</strong> and <strong>smart scheduling</strong>.</p>
        </section>

        <section class="section">
            <div class="section-num">02</div>
            <h2>Hardware Requirements</h2>
            <h3>Per-Node Specs</h3>
            <div class="property-grid">
                <div class="property-card"><div class="property-name">GPU</div><div class="property-desc">NVIDIA RTX 4090 (24GB) or A100 (40/80GB)</div></div>
                <div class="property-card"><div class="property-name">CPU</div><div class="property-desc">16+ cores for data loading</div></div>
                <div class="property-card"><div class="property-name">RAM</div><div class="property-desc">64GB+ (images loaded to RAM)</div></div>
                <div class="property-card"><div class="property-name">Storage</div><div class="property-desc">NVMe SSD, 2TB+ per node</div></div>
            </div>
            <h3>Cluster Options</h3>
            <div class="table-wrapper">
                <table>
                    <tr><th>Option</th><th>Cost</th><th>Pros</th><th>Cons</th></tr>
                    <tr><td><strong>Cloud (RunPod, Vast.ai)</strong></td><td>~$1-2/hr per GPU</td><td>No upfront, scalable</td><td>Recurring cost, data transfer</td></tr>
                    <tr><td><strong>On-prem cluster</strong></td><td>~$15K per node</td><td>Fixed cost, fast local storage</td><td>Maintenance, upfront capital</td></tr>
                    <tr><td><strong>Hybrid</strong></td><td>Mixed</td><td>Burst capacity</td><td>Complexity</td></tr>
                </table>
            </div>
            <div class="info-box"><p><strong>SIREN Recommendation:</strong> Start with cloud (RunPod) for flexibility, consider on-prem once you have predictable volume.</p></div>
        </section>

        <section class="section">
            <div class="section-num">03</div>
            <h2>Pipeline Architecture</h2>
            <div class="diagram">
                <div class="diagram-row">
                    <div class="diagram-box">Raw Capture</div>
                    <span class="diagram-arrow">→</span>
                    <div class="diagram-box">Ingest Queue</div>
                    <span class="diagram-arrow">→</span>
                    <div class="diagram-box">Preprocessing</div>
                </div>
                <div class="diagram-row">
                    <span class="diagram-arrow">→</span>
                    <div class="diagram-box">COLMAP</div>
                    <span class="diagram-arrow">→</span>
                    <div class="diagram-box">3DGS Training</div>
                    <span class="diagram-arrow">→</span>
                    <div class="diagram-box">Post-process</div>
                </div>
                <div class="diagram-row">
                    <span class="diagram-arrow">→</span>
                    <div class="diagram-box">Compression</div>
                    <span class="diagram-arrow">→</span>
                    <div class="diagram-box">CDN Upload</div>
                    <span class="diagram-arrow">→</span>
                    <div class="diagram-box">Ready ✓</div>
                </div>
            </div>
            <h3>Job Queue System</h3>
            <p>Use a robust job queue to manage training tasks across workers.</p>
            <div class="code-block"><code><span class="comment"># Example: Redis-based job queue with Python RQ</span>
<span class="keyword">from</span> redis <span class="keyword">import</span> Redis
<span class="keyword">from</span> rq <span class="keyword">import</span> Queue

redis_conn = Redis(host=<span class="string">'redis.internal'</span>, port=<span class="number">6379</span>)
training_queue = Queue(<span class="string">'training'</span>, connection=redis_conn)

<span class="keyword">def</span> <span class="function">submit_scene</span>(scene_id, frame_range):
    <span class="string">"""Submit a training job for a scene's frame range"""</span>
    job = training_queue.enqueue(
        <span class="string">'workers.train_frames'</span>,
        scene_id=scene_id,
        start_frame=frame_range[<span class="number">0</span>],
        end_frame=frame_range[<span class="number">1</span>],
        job_timeout=<span class="string">'24h'</span>,
        result_ttl=<span class="number">86400</span>
    )
    <span class="keyword">return</span> job.id

<span class="comment"># Submit a scene split across multiple jobs</span>
scene_id = <span class="string">'scene_001'</span>
total_frames = <span class="number">1800</span>
batch_size = <span class="number">100</span>

<span class="keyword">for</span> start <span class="keyword">in</span> range(<span class="number">0</span>, total_frames, batch_size):
    submit_scene(scene_id, (start, start + batch_size))</code></div>
        </section>

        <section class="section">
            <div class="section-num">04</div>
            <h2>Worker Implementation</h2>
            <div class="code-block"><code><span class="comment"># workers/train_frames.py</span>
<span class="keyword">import</span> subprocess
<span class="keyword">import</span> os
<span class="keyword">from</span> pathlib <span class="keyword">import</span> Path

<span class="keyword">def</span> <span class="function">train_frames</span>(scene_id: str, start_frame: int, end_frame: int):
    <span class="string">"""Train 3DGS for a range of frames"""</span>
    
    scene_path = Path(f<span class="string">'/data/scenes/{scene_id}'</span>)
    output_path = Path(f<span class="string">'/data/output/{scene_id}/splats'</span>)
    output_path.mkdir(parents=<span class="keyword">True</span>, exist_ok=<span class="keyword">True</span>)
    
    <span class="keyword">for</span> frame_idx <span class="keyword">in</span> range(start_frame, end_frame):
        frame_dir = scene_path / <span class="string">'synced'</span> / f<span class="string">'frame_{frame_idx:04d}'</span>
        
        <span class="keyword">if</span> <span class="keyword">not</span> frame_dir.exists():
            <span class="keyword">continue</span>
            
        <span class="comment"># Run 3DGS training</span>
        cmd = [
            <span class="string">'python'</span>, <span class="string">'train.py'</span>,
            <span class="string">'-s'</span>, str(frame_dir),
            <span class="string">'-m'</span>, str(output_path / f<span class="string">'frame_{frame_idx:04d}'</span>),
            <span class="string">'--iterations'</span>, <span class="string">'7000'</span>,  <span class="comment"># Reduced for speed</span>
            <span class="string">'--densify_until_iter'</span>, <span class="string">'5000'</span>,
        ]
        
        result = subprocess.run(cmd, capture_output=<span class="keyword">True</span>)
        
        <span class="keyword">if</span> result.returncode != <span class="number">0</span>:
            <span class="keyword">raise</span> Exception(f<span class="string">'Training failed: {result.stderr}'</span>)
        
        <span class="comment"># Export to compressed format</span>
        export_splat(
            input_path=output_path / f<span class="string">'frame_{frame_idx:04d}'</span>,
            output_path=output_path / f<span class="string">'frame_{frame_idx:04d}.splat'</span>
        )
    
    <span class="keyword">return</span> {<span class="string">'status'</span>: <span class="string">'complete'</span>, <span class="string">'frames_processed'</span>: end_frame - start_frame}</code></div>
        </section>

        <section class="section">
            <div class="section-num">05</div>
            <h2>Monitoring & Observability</h2>
            <p>You need visibility into your training pipeline. Essential metrics:</p>
            <div class="property-grid">
                <div class="property-card"><div class="property-name">GPU Utilization</div><div class="property-desc">Should be >90% during training</div></div>
                <div class="property-card"><div class="property-name">Queue Depth</div><div class="property-desc">Pending jobs per queue</div></div>
                <div class="property-card"><div class="property-name">Training Loss</div><div class="property-desc">PSNR/SSIM per frame</div></div>
                <div class="property-card"><div class="property-name">Throughput</div><div class="property-desc">Frames/hour across cluster</div></div>
            </div>
            <h3>Dashboard Stack</h3>
            <div class="code-block"><code><span class="comment"># docker-compose.monitoring.yml</span>
services:
  prometheus:
    image: prom/prometheus
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - <span class="string">"9090:9090"</span>

  grafana:
    image: grafana/grafana
    ports:
      - <span class="string">"3000:3000"</span>
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin

  nvidia-exporter:
    image: utkuozdemir/nvidia_gpu_exporter
    runtime: nvidia
    ports:
      - <span class="string">"9835:9835"</span></code></div>
        </section>

        <section class="section">
            <div class="section-num">06</div>
            <h2>Cost Optimization</h2>
            <h3>Spot/Preemptible Instances</h3>
            <p>Training jobs are <strong>restartable</strong>. Use spot instances for 60-80% cost savings.</p>
            <div class="code-block"><code><span class="comment"># Checkpoint frequently to survive preemption</span>
<span class="keyword">def</span> <span class="function">train_with_checkpoints</span>(scene_id, frame_idx, checkpoint_every=<span class="number">1000</span>):
    checkpoint_path = f<span class="string">'/checkpoints/{scene_id}/frame_{frame_idx}'</span>
    
    <span class="comment"># Resume from checkpoint if exists</span>
    start_iter = <span class="number">0</span>
    <span class="keyword">if</span> os.path.exists(f<span class="string">'{checkpoint_path}/latest.pth'</span>):
        start_iter = load_checkpoint(checkpoint_path)
    
    <span class="keyword">for</span> iteration <span class="keyword">in</span> range(start_iter, <span class="number">7000</span>):
        train_step()
        
        <span class="keyword">if</span> iteration % checkpoint_every == <span class="number">0</span>:
            save_checkpoint(checkpoint_path, iteration)</code></div>
            <h3>Cost Estimates</h3>
            <div class="table-wrapper">
                <table>
                    <tr><th>Instance Type</th><th>$/hr</th><th>Cost per Scene (5min)</th></tr>
                    <tr><td><strong>RTX 4090 (RunPod)</strong></td><td>$0.74</td><td>~$800</td></tr>
                    <tr><td><strong>RTX 4090 Spot</strong></td><td>$0.30</td><td>~$320</td></tr>
                    <tr><td><strong>A100 40GB</strong></td><td>$1.89</td><td>~$650 (faster)</td></tr>
                    <tr><td><strong>A100 Spot</strong></td><td>$0.80</td><td>~$275</td></tr>
                </table>
            </div>
            <div class="info-box"><p><strong>Key insight:</strong> A100s are often more cost-effective than 4090s due to faster training despite higher hourly rate.</p></div>
        </section>

        <section class="section">
            <div class="section-num">07</div>
            <h2>Automation & CI/CD</h2>
            <p>Automate the entire pipeline from upload to delivery.</p>
            <div class="code-block"><code><span class="comment"># Example: GitHub Actions workflow for new content</span>
name: Process New Scene

on:
  workflow_dispatch:
    inputs:
      scene_id:
        description: <span class="string">'Scene ID to process'</span>
        required: true

jobs:
  ingest:
    runs-on: self-hosted
    steps:
      - name: Validate scene data
        run: python scripts/validate_scene.py ${{ inputs.scene_id }}
      
      - name: Run COLMAP calibration
        run: python scripts/run_colmap.py ${{ inputs.scene_id }}
      
      - name: Submit training jobs
        run: python scripts/submit_training.py ${{ inputs.scene_id }}
      
  monitor:
    needs: ingest
    runs-on: ubuntu-latest
    steps:
      - name: Wait for training completion
        run: python scripts/wait_for_jobs.py ${{ inputs.scene_id }}
      
      - name: Run compression pipeline
        run: python scripts/compress_splats.py ${{ inputs.scene_id }}
      
      - name: Upload to CDN
        run: python scripts/upload_cdn.py ${{ inputs.scene_id }}
      
      - name: Update content catalog
        run: python scripts/update_catalog.py ${{ inputs.scene_id }}</code></div>
        </section>

        <section class="section">
            <div class="section-num">08</div>
            <h2>Scaling Roadmap</h2>
            <h3>Phase 1: MVP (1-10 scenes/month)</h3>
            <ul>
                <li>2-4 cloud GPUs on RunPod</li>
                <li>Manual job submission</li>
                <li>Basic monitoring</li>
            </ul>
            <h3>Phase 2: Growth (10-50 scenes/month)</h3>
            <ul>
                <li>8-16 GPUs, mix of on-demand and spot</li>
                <li>Automated pipeline with job queue</li>
                <li>Full monitoring stack</li>
            </ul>
            <h3>Phase 3: Scale (50+ scenes/month)</h3>
            <ul>
                <li>On-prem cluster + cloud burst</li>
                <li>Custom training optimizations</li>
                <li>Dedicated ops team</li>
            </ul>
        </section>

        <nav class="nav-footer">
            <a href="../path-c-streaming/" class="nav-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg><div><div class="nav-btn-label">Previous</div><div class="nav-btn-title">C: Compression & Streaming</div></div></a>
            <a href="../path-e-viewer/" class="nav-btn next"><div><div class="nav-btn-label">Next</div><div class="nav-btn-title">E: The Viewer / Player</div></div><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></a>
        </nav>
    </div>
    <script>gsap.from('.page-header', { opacity: 0, y: 30, duration: 0.8 }); gsap.from('.section', { opacity: 0, y: 40, duration: 0.8, stagger: 0.15, delay: 0.2 });</script>
</body>
</html>
